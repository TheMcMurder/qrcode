# ADR 0002: WASM Dependency Resolution in Monorepo

## Status

Accepted

## Context

The web example (`examples/web`) imports the WASM package (`@qrcode/wasm`) generated by `wasm-pack` in `bindings/wasm/pkg`. TypeScript (`tsc`) fails to find the module or its type declarations during build, even though Vite can resolve it at runtime with an alias. Symlinking `pkg` into `node_modules` works but is not robust for teams or CI, as symlinks are not persisted in git and require manual or scripted setup.

## Decision

We will use a file dependency in `examples/web/package.json`:

```json
"@qrcode/wasm": "file:../../bindings/wasm/pkg"
```

After every `wasm-pack build`, we will run `pnpm install` in `examples/web` to update the local dependency. This ensures both TypeScript and Vite can resolve the module and its types from `node_modules`. This approach is cross-platform, robust, and works for all developers and CI environments.

## Consequences

- The build process requires an extra step: after building the WASM package, developers must run `pnpm install` in the web example to update the dependency.
- The solution is robust and works across platforms and CI environments.
- (Optional) This process can be automated with a script or Turborepo pipeline step in the future.

## Next Steps

- Update `examples/web/package.json` to use the file dependency for `@qrcode/wasm`.
- Document the workflow: after building WASM, always run `pnpm install` in the web example.
- (Optional) Automate this with a script or Turborepo pipeline step.
